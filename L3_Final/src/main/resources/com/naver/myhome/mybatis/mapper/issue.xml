<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.naver.myhome.mybatis.mapper.IssueMapper">
	<select id="getListCount" resultType="int">
		select count(*) from issue
	</select>

	<select id="getIssueList" resultType="issue">
		select * from issue order
		by issue_created desc
	</select>
	

	<select id="getFilteredIssueList" resultType="com.naver.myhome.domain.Issue">
  	SELECT * FROM issue
		<where>
  		<if test='issueType != "-"'>
    		issue_status = #{issueType}
  		</if>
  		<if test='issuePriority != "-"'>
    		AND issue_priority = #{issuePriority}
  		</if>
 		</where>
  	ORDER BY issue_created DESC
	</select>

	<select id="searchIssues" resultType="com.naver.myhome.domain.Issue">
   	SELECT *
		FROM issue
			WHERE UPPER(issue_subject) LIKE '%' || UPPER(#{searchText}) || '%'
   		OR UPPER(create_user) LIKE '%' || UPPER(#{searchText}) || '%'
   		ORDER BY issue_created DESC
  </select>
  
 <!--  <select id="getProjectList" resultType="com.naver.myhome.domain.Project">
  	select project_name from project
  	where project_joiner.user_id = #{user.id}
  </select> -->
  
  <insert id="issueAdd">
  	<selectKey order="BEFORE" keyProperty="issue_id" resultType="int">
  	select issue_id.nextval from dual
  	</selectKey>
  	<!-- <selectKey order="BEFORE" keyProperty="user_name" resultType="String">
		select user_name from usr where user_id=1 
  	</selectKey> -->
<!-- 다른 항목들이 완료되었을 때 사용할 쿼리
		insert into issue
  	values
  	(#{issue_id},
  	(select project_id from project where project_name = #{project_name}),
  	(select user_name from user where user_id = #{user_id}),
  	#{issue_type}, #{issue_priority}, #{issue_subject}, #{issue_content}, #{issue_status},
  	#{issue_reporter}, #{issue_assigned}, #{issue_file}, SYSDATE) -->
  	
  	insert into issue
  	values
  	(#{issue_id}, 1, '홍길동', #{issue_type},
  	#{issue_priority}, #{issue_subject}, #{issue_content},
  	#{issue_status}, #{issue_reporter}, #{issue_assigned}, #{issue_file}, SYSDATE)
  </insert>

	<select id="getIssueDetail" resultType="issue">
		<!-- select (select project_name from project where project_id = #{project_id}),
		issue_subject, issue_content, issue_reporter, issue_assigned, issue_file
		from issue -->
		
		select
		issue_subject, issue_content, issue_reporter, issue_assigned, issue_file
		from issue
		where issue_id = #{issue_id}
	</select>
</mapper>