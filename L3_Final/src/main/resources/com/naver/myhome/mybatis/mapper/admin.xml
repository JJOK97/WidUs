<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.naver.myhome.mybatis.mapper.AdminMapper">

   <!-- 지니 -->
   <!-- 정상 -->
   <select id="findEmployee" resultType="employee">
      select u.pic, e.id ,u.name, e.department, e.position, u.email, u.phone,
      e.auth 
      from employee e
         inner join
             users u on e.user_id = u.id
      where e.company_id = #{companyId}
      and e.status = 0
      order by u.name
   </select>
   
   <select id="countEmployee" resultType="int">
      select count (*) as countValue
      from employee e
         inner join 
              users u on e.user_id = u.id
      WHERE e.company_id = #{companyId}
       and e.status = 0
   </select>
   
   <!-- 이용중지 -->
    <select id="stopEmployee" resultType="employee">
      select u.pic, e.id ,u.name, e.department, e.position, u.email, u.phone,
      e.auth 
      from employee e
         inner join
             users u on e.user_id = u.id
      where e.company_id = #{companyId}
      and e.status=1
      order by u.name
   </select>
   
   <select id="countStopEmployee" resultType="int">
      select count (*) as countStopValue
      from employee e
         inner join 
              users u on e.user_id = u.id
      WHERE e.company_id = #{companyId}
      and e.status=1
   </select>
   
   <!-- 이용중지 업데이트 -->
   <update id="stopEmployeeStatus" parameterType="int">
   update employee
   set status= 1
   where id=#{employeeId}
   </update>
   
   <update id="useEmployeeStatus" parameterType="int">
   update employee
   set status= 0
   where id=#{employeeId}
   </update>
   
   <!-- 관리자 유무 업데이트 -->
   <update id="noMoreAuth" parameterType="int">
   update employee
   set auth= 'N'
   where id=#{employeeId}
   </update>
   
   <update id="addAuth" parameterType="int">
   update employee
   set auth= 'Y'
   where id=#{employeeId}
   </update>
   
   <!-- 가입승인 후 직원 추가 -->
   <insert id="addEmployee" >
   INSERT INTO employee (id, company_id, user_id)
    VALUES (employee_id.nextval, #{companyId}, #{userId} )
   </insert>
   
   <!-- 회사 정보 -->
   <select id="companyInfo" resultType="Company">
   select name, domain
   from company
   where id = #{companyId}
   </select>
   
   <select id="companyName" resultType="String">
   select name
   from company
   where id = #{companyId}
   </select>
   
   <select id="companyDomain" resultType="String">
   select domain
   from company
   where id = #{companyId}
   </select>
 

    <!-- 회사명 업데이트 -->
    <update id ="updateName">
    update company
    set name = #{companyName}
    where id = #{companyId}
    </update>
    
    <!-- 회사도메인 업데이트 -->
    <update id ="updateDomain">
    update company
    set domain = #{companyDomain}
    where id = #{companyId}
    </update>
    
    <!-- 혜원 -->
    <select id="getAccesslist" resultType="Access">


SELECT COUNT(*), user_id, connectdate
FROM connectlist
WHERE connectdate LIKE '23/09%'
GROUP BY user_id, connectdate
UNION
SELECT COUNT(*), user_id, connectdate
FROM connectlist
WHERE connectdate LIKE '23/10%'
GROUP BY user_id, connectdate
   
   
</select>



<select id="getDayCount" resultType="Access">
  SELECT TO_DATE(CONNECTDATE, 'YYYY-MM-DD') AS date, COUNT(*) AS daycount
  FROM connectlist
  WHERE CONNECTDATE >= TO_DATE(TO_CHAR(SYSDATE - 7, 'YYYY-MM-DD'), 'YYYY-MM-DD')
  GROUP BY TO_DATE(CONNECTDATE, 'YYYY-MM-DD')
  ORDER BY TO_DATE(CONNECTDATE, 'YYYY-MM-DD')
</select>



<!-- <select id="getMonthCount" resultType="Access">

SELECT TO_CHAR(CONNECTDATE, 'YYYY-MM') AS month, COUNT(*) AS monthcount
FROM connectlist
WHERE CONNECTDATE >= ADD_MONTHS(TRUNC(SYSDATE), -6)
GROUP BY TO_CHAR(CONNECTDATE, 'YYYY-MM')
ORDER BY TO_CHAR(CONNECTDATE, 'YYYY-MM')
   
   
</select> -->

<select id="getMonthCount" resultMap="accessResultMap">
    SELECT TO_CHAR(CONNECTDATE, 'YYYY-MM') AS month, COUNT(*) AS monthcount
    FROM connectlist
    WHERE CONNECTDATE >= ADD_MONTHS(TRUNC(SYSDATE), -6)
    GROUP BY TO_CHAR(CONNECTDATE, 'YYYY-MM')
    ORDER BY TO_CHAR(CONNECTDATE, 'YYYY-MM')
</select>

<resultMap id="accessResultMap" type="Access">
    <result property="month" column="month" />
    <result property="monthcount" column="monthcount" />
</resultMap>

 	

</mapper>